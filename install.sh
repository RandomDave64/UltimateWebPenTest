#!/bin/bash

echo "Installing dependencies"
sudo apt update
sudo apt install -y docker.io docker-compose 
sudo apt install -y apache2
sudo docker volume create portainer_data

clear
echo "Modifying /etc/issue file and Main Web Front Page"
sudo bash -c 'echo "Welcome to the Ultimate Web Pentesting Lab" >> /etc/issue'
sudo bash -c 'echo "" >> /etc/issue'
sudo bash -c 'echo "To access the Main Web Portal go to http://\4{ens32}" >> /etc/issue'
sudo bash -c 'echo "To Manage Deployed Containers using Portainer go to http://\4{ens32}:9000"'
sudo bash -c 'echo "" >> /etc/issue'
sudo bash -c 'echo "The IP Address for this VM is: \4{ens32}" >> /etc/issue'
sudo bash -c 'echo "" >> /etc/issue'
sudo bash -c 'echo "" >> /etc/issue'
sudo bash -c 'echo "" >> /etc/issue'
sudo mv index.html /var/www/html/index.html

clear
echo "Downloading Docker Containers - This will take a while"

sudo docker pull santosomar/webgoat
sudo docker pull appsecco/webgoat-dot-net
sudo docker pull santosomar/dvwa
sudo docker pull virg/hackazon-https
sudo docker pull santosomar/mutillidae_2
sudo docker pull santosomar/dvna 
sudo docker pull santosomar/bwapp
sudo docker pull bwolmarans/badstore
sudo docker pull santosomar/mayhem
sudo docker pull santosomar/rtv-safemode
sudo docker pull santosomar/grayhat-mmxx
sudo docker pull santosomar/yascon-hackme
sudo docker pull santosomar/secretcorp-branch1
sudo docker pull adamdoupe/wackopicko
sudo docker pull santosomar/gravemind
sudo docker pull santosomar/hackme-rtov
sudo docker pull vulnerables/cve-2014-6271
sudo docker pull vulnerables/cve-2014-0160
sudo docker pull acgpiano/sqli-labs
sudo docker pull eystsen/vulnerablewordpress
sudo docker pull justhumanz/web_for_pentest
sudo docker pull eystsen/altoro
sudo docker pull opendns/security-ninjas
sudo docker pull citizenstig/owaspbricks
sudo docker pull contrastsecuritydemo/terracotta-bank:1.0
sudo docker pull hightechsec/xsslabs
sudo docker pull 10security/gruyere:1.1
sudo docker pull bkimminich/juice-shop
sudo docker pull sasanlabs/owasp-vulnerableapp

clear
echo "Deploying Web Application Containers"

sudo docker run -it -d --restart unless-stopped -p 9090:9090 -p 9080:8080 santosomar/webgoat
sudo docker run -it -d --restart unless-stopped -p 9900:9000 appsecco/webgoat-dot-net
sudo docker run -it -d --restart unless-stopped -p 8081:80 santosomar/dvwa
sudo docker run -it -d --restart unless-stopped -p 8082:80 -p 9443:443 virg/hackazon-https
sudo docker run -it -d --restart unless-stopped -p 8083:80 -p 3310:3306 santosomar/mutillidae_2
sudo docker run -it -d --restart unless-stopped -p 8084:9090 santosomar/dvna 
sudo docker run -it -d --restart unless-stopped -p 8085:80 -p 3308:3306 santosomar/bwapp
sudo docker run -it -d --restart unless-stopped -p 8086:80 bwolmarans/badstore
sudo docker run -it -d --restart unless-stopped -p 8087:80 -p 2022:22 santosomar/mayhem
sudo docker run -it -d --restart unless-stopped -p 8088:80 -p 3311:3306 santosomar/rtv-safemode
sudo docker run -it -d --restart unless-stopped -p 8089:8000 santosomar/grayhat-mmxx
sudo docker run -it -d --restart unless-stopped -p 8090:80 santosomar/yascon-hackme
sudo docker run -it -d --restart unless-stopped -p 8091:80 santosomar/secretcorp-branch1
sudo docker run -it -d --restart unless-stopped -p 8092:80 -p 3312:3306 adamdoupe/wackopicko
sudo docker run -it -d --restart unless-stopped -p 8093:80 santosomar/gravemind
sudo docker run -it -d --restart unless-stopped -p 8095:80 santosomar/hackme-rtov
sudo docker run -it -d --restart unless-stopped -p 8096:80 vulnerables/cve-2014-6271
sudo docker run -it -d --restart unless-stopped -p 8097:80 -p 8443:443 vulnerables/cve-2014-0160
sudo docker run -it -d --restart unless-stopped -p 8098:80 -p 3313:3306 acgpiano/sqli-labs
sudo docker run -it -d --restart unless-stopped -p 8099:80 -p 3314:3306 eystsen/vulnerablewordpress
sudo docker run -it -d --restart unless-stopped -p 8100:80 justhumanz/web_for_pentest
sudo docker run -it -d --restart unless-stopped -p 8102:8080 eystsen/altoro
sudo docker run -it -d --restart unless-stopped -p 8103:80 opendns/security-ninjas
sudo docker run -it -d --restart unless-stopped -p 8104:80 -p 3315:3306 citizenstig/owaspbricks
sudo docker run -it -d --restart unless-stopped -p 8105:8080 contrastsecuritydemo/terracotta-bank:1.0
sudo docker run -it -d --restart unless-stopped -p 8106:80 hightechsec/xsslabs
sudo docker run -it -d --restart unless-stopped -p 8008:8008 10security/gruyere:1.1
sudo docker run -it -d --restart unless-stopped -p 3000:3000 bkimminich/juice-shop
sudo docker run -it -d --restart unless-stopped -p 9099:9090 sasanlabs/owasp-vulnerableapp

echo "deploying Portainer"
sudo docker run -d -p 9000:9000 --name=portainer --restart=unless-stopped -v /var/run/docker.sock:/var/run/docker.sock -v portainer_data:/data portainer/portainer-ce

clear
echo "Verify containers are all running"
sudo docker ps
